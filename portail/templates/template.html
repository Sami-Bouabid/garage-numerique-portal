{% extends 'base.html' %}

{% block content %}
<section class="section">
    <div class="container">
        {% if resource %}
        <div class="columns is-vcentered">
            <div class="column is-one-third">
                <figure class="image is-1by1">
                    <img src="{{ resource.icon }}" alt="{{ resource.title }}">
                </figure>
                <p class="has-text-centered mt-4">
                    <a href="{{ resource.url }}" target="_blank" class="button is-primary is-large">
                        Visiter le site
                    </a>
                </p>
                {# BOUTONS D'ACTION (doivent toujours être ici pour resourceDetail.js) #}
                {% if resource.packet_name %}
                <div class="buttons is-centered mt-4">
                    <button class="button is-success is-large is-install" data-packet-name="{{ resource.packet_name }}" style="display: none;">
                        Télécharger
                    </button>
                    <button class="button is-danger is-large is-uninstall" data-packet-name="{{ resource.packet_name }}" style="display: none;">
                        Désinstaller
                    </button>
                    <button class="button is-info is-large is-launch" data-packet-name="{{ resource.packet_name }}" style="display: none;">
                        Lancer
                    </button>
                </div>
                {% else %}
                    {# Ce bloc s'affichera si resource.packet_name est vide ou non défini #}
                    <p class="has-text-centered mt-4 notification is-warning is-light">
                        Nom de paquet système (packet_name) non disponible pour cette ressource.
                    </p>
                {% endif %}
            </div>
            <div class="column is-two-thirds">
                <h1 class="title is-2 has-text-black">{{ resource.title }}</h1>
                <p class="subtitle is-5 has-text-black">{{ resource.short_desc }}</p>

                <div class="content mt-4">
                    <p>{{ resource.long_desc | replace('\n', '<br>') | safe }}</p>
                    <hr>
                    <p><strong>Type de contenu :</strong> <span class="tag has-background-primary-40 has-text-weight-bold has-text-white is-info">{{ resource.content_type }}</span></p>
                    <p><strong>Thèmes :</strong>
                        {% for subject in resource.subjects %}
                            <span class="tag has-background-primary-40  has-text-weight-bold has-text-white is-info mr-1">{{ subject }}</span>
                        {% endfor %}
                    </p>
                    {% if resource.comments %}
                        <p><strong>Commentaires :</strong> {{ resource.comments }}</p>
                    {% endif %}
                </div>
            </div>
        </div>

        {% if resource.featured_image %}
        <div class="mt-6">
            <h2 class="title is-4">Image mise en avant</h2>
            <figure class="image">
                <img src="{{ resource.featured_image }}" alt="Image principale de {{ resource.title }}">
            </figure>
        </div>
        {% endif %}

        {% if resource.illustrations and resource.illustrations | length > 0 %}
        <div class="mt-6">
            <h2 class="title is-4">Illustrations</h2>
            <div class="columns is-multiline">
                {% for illustration in resource.illustrations %}
                <div class="column is-one-quarter">
                    <figure class="image is-4by3">
                        <img src="{{ illustration }}" alt="Illustration de {{ resource.title }}">
                    </figure>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="has-text-centered mt-6">
            <a href="/" class="button is-link is-large">Retour à la liste</a>
        </div>

        {% else %}
        <div class="notification is-danger">
            La ressource demandée n'a pas été trouvée.
        </div>
        {% endif %}
    </div>
</section>

{# DÉBUT DES MODALES - Placées ici, elles sont dans le bloc 'content' mais restent logiquement groupées et présentes sur la page #}
<div class="modal" id="resultModal">
    <div class="modal-background"></div>
    <div class="modal-card">
        <header class="modal-card-head" id="modalHeader">
            <p class="modal-card-title" id="modalTitle"></p>
            <button class="delete" aria-label="close" id="closeModalButton"></button>
        </header>
        <section class="modal-card-body">
            <p id="modalMessage"></p>
        </section>
        <footer class="modal-card-foot is-justify-content-flex-end">
            <button class="button is-light" id="closeModalFooterButton">Fermer</button>
        </footer>
    </div>
</div>

<div class="modal" id="loadingOverlay">
    <div class="modal-background"></div>
    <div class="modal-content has-text-centered">
        <div class="box p-5">
            <div class="loading-spinner"></div>
            <p class="has-text-white is-size-5 mt-4" id="loadingMessage">Opération en cours...</p>
        </div>
    </div>
</div>
{# FIN DES MODALES #}

{% endblock %}

{% block scripts %}
    {{ super() }} 
    <script type="module" src="{{ url_for('portail.static', filename='js/modal.js') }}"></script>
    <script type="module" src="{{ url_for('portail.static', filename='js/resourceDetail.js') }}"></script>
{% endblock %}